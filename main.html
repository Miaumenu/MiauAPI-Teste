<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>MiauAPI Smart</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: transparent;
            color: white;
        }
        .container {
            position: absolute;
            width: 860px;
            height: 660px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff00;
            border-radius: 15px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            cursor: move;
        }
        h1 {
            text-align: center;
            color: #00ff00;
            margin-bottom: 30px;
        }
        .toggle-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            cursor: pointer;
        }
        .toggle-switch input { display: none; }
        .toggle-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #ccc;
            border-radius: 15px;
            transition: all 0.3s;
        }
        .toggle-switch input:checked + .toggle-bg {
            background: #00ff00;
        }
        .toggle-handle {
            position: absolute;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
        }
        .toggle-switch input:checked ~ .toggle-handle {
            left: 27px;
        }
        .log {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            font-size: 11px;
            max-height: 100px;
            overflow-y: auto;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <h1>ðŸ§  SMART SYSTEM</h1>
        
        <div class="toggle-item" data-feature="godmod">
            <span>GodMod</span>
            <label class="toggle-switch">
                <input type="checkbox">
                <div class="toggle-bg"></div>
                <div class="toggle-handle"></div>
            </label>
        </div>
        
        <div class="toggle-item" data-feature="heal">
            <span>Heal</span>
            <label class="toggle-switch">
                <input type="checkbox">
                <div class="toggle-bg"></div>
                <div class="toggle-handle"></div>
            </label>
        </div>
        
        <div class="toggle-item" data-feature="suicide">
            <span>Suicide</span>
            <label class="toggle-switch">
                <input type="checkbox">
                <div class="toggle-bg"></div>
                <div class="toggle-handle"></div>
            </label>
        </div>
        
        <div class="toggle-item" data-feature="noclip">
            <span>Noclip</span>
            <label class="toggle-switch">
                <input type="checkbox">
                <div class="toggle-bg"></div>
                <div class="toggle-handle"></div>
            </label>
        </div>
        
        <div class="toggle-item" data-feature="superjump">
            <span>Super Jump</span>
            <label class="toggle-switch">
                <input type="checkbox">
                <div class="toggle-bg"></div>
                <div class="toggle-handle"></div>
            </label>
        </div>
        
        <div class="log" id="log">
            <div>Sistema carregado. Aguardando interaÃ§Ã£o...</div>
        </div>
    </div>
    
    <script>
        const container = document.getElementById('container');
        const logEl = document.getElementById('log');
        
        function addLog(msg) {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logEl.appendChild(div);
            logEl.scrollTop = logEl.scrollHeight;
            console.log(msg);
        }
        
        // FunÃ§Ã£o para calcular coordenadas RELATIVAS dos toggles
        function getButtonPositions() {
            const buttons = {};
            const toggles = document.querySelectorAll('.toggle-switch');
            
            toggles.forEach(toggle => {
                const item = toggle.closest('.toggle-item');
                const feature = item.getAttribute('data-feature');
                const rect = toggle.getBoundingClientRect();
                
                // Coordenadas ABSOLUTAS na tela (0-1)
                const x = (rect.left + rect.width / 2) / window.innerWidth;
                const y = (rect.top + rect.height / 2) / window.innerHeight;
                const width = rect.width / window.innerWidth;
                const height = rect.height / window.innerHeight;
                
                buttons[feature] = { x, y, width, height };
            });
            
            return buttons;
        }
        
        // Envia coordenadas para o Lua
        function sendButtonPositions() {
            const positions = getButtonPositions();
            
            addLog('Enviando coordenadas para Lua...');
            
            fetch('https://miauapi/updateButtonPositions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ buttons: positions })
            })
            .then(() => {
                addLog('âœ“ Coordenadas enviadas!');
            })
            .catch((error) => {
                addLog('âœ— Erro ao enviar: ' + error.message);
            });
        }
        
        // Dragging
        let isDragging = false;
        let startX, startY, initialX, initialY;
        
        container.addEventListener('mousedown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.closest('.toggle-switch')) return;
            
            isDragging = true;
            const rect = container.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
            initialX = rect.left;
            initialY = rect.top;
        });
        
        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            const newX = e.clientX - startX;
            const newY = e.clientY - startY;
            
            container.style.left = newX + 'px';
            container.style.top = newY + 'px';
            container.style.transform = 'none';
        });
        
        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                addLog('Interface arrastada! Atualizando coordenadas...');
                
                // Notifica Lua sobre drag
                fetch('https://miauapi/onDrag', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                }).catch(() => {});
                
                // Envia novas coordenadas
                setTimeout(sendButtonPositions, 100);
            }
        });
        
        // Listener para mensagens do Lua
        window.addEventListener('message', (event) => {
            const data = event.data;
            
            if (data.type === 'requestButtonPositions') {
                addLog('Lua solicitou coordenadas');
                sendButtonPositions();
            }
            
            if (data.type === 'updateToggle') {
                addLog(`Atualizando ${data.feature}: ${data.active}`);
                const item = document.querySelector(`[data-feature="${data.feature}"]`);
                if (item) {
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    checkbox.checked = data.active;
                }
            }
        });
        
        // Envia coordenadas ao carregar
        setTimeout(() => {
            addLog('Enviando coordenadas iniciais...');
            sendButtonPositions();
        }, 1000);
        
        addLog('Sistema carregado!');
    </script>
</body>
</html>
