<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MiauAPI – Notificações</title>
  <!-- Vue 2 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <style>
    /* Reset básico */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 1920px;
      height: 1080px;
      overflow: hidden;
      background: transparent;
      font-family: 'Inter', sans-serif;
    }
    /* Container dos componentes Vue */
    #app {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }
    /* Lista de notificações */
    .infobox-container {
      position: absolute;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    /* Cada notificação */
    .infobox {
      display: flex;
      align-items: stretch;
      max-width: 600px;
      width: calc(100% - 40px);
      padding: 15px 20px;
      background: rgba(0,0,0,0.7);
      border-radius: 14px;
      border: 2px solid var(--border);
      box-shadow: var(--shadow);
      pointer-events: auto;
      animation: slideIn 0.25s ease-out;
    }
    .infobox-exit { animation: slideOut 0.25s ease-in forwards; }
    .infobox-accent {
      width: 6px;
      background: var(--accent);
      box-shadow: var(--accent) 0 0 10px;
      border-radius: 14px;
      margin-right: 20px;
    }
    .infobox-content { flex: 1; }
    .infobox-prefix { font-weight: 700; margin-right: 6px; color: #FFF; }
    .infobox-message { color: #FFF; font-weight: 600; line-height: 1.3; word-break: break-word; }
    /* Animações */
    @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes slideOut { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-20px); opacity: 0; } }
    /* Cores por nível */
    .informacao { --border: rgba(0,170,255,0.7); --shadow: rgba(0,170,255,0.25) 0 0 20px; --accent: #00AAFF; }
    .sucesso    { --border: rgba(17,255,0,0.7);    --shadow: rgba(17,255,0,0.25) 0 0 20px;    --accent: #11FF00; }
    .aviso      { --border: rgba(238,255,0,0.7);   --shadow: rgba(238,255,0,0.25) 0 0 20px;   --accent: #EEFF00; }
    .erro       { --border: rgba(255,0,0,0.7);     --shadow: rgba(255,0,0,0.25) 0 0 20px;     --accent: #FF0000; }
  </style>
</head>
<body>
  <div id="app">
    <!-- Container para cada posição -->
    <div v-for="(list, pos) in groups" :key="pos"
         class="infobox-container"
         :style="{ left: posX(pos) + 'px', top: posY(pos) + 'px' }">
      <transition-group name="infobox" tag="div">
        <div v-for="msg in list" :key="msg.id"
             class="infobox"
             :class="msg.level"
             @animationend="onAnimationEnd(msg)">
          <div class="infobox-accent"></div>
          <div class="infobox-content">
            <span class="infobox-prefix">{{ prefixes[msg.level] }}</span>
            <span class="infobox-message" v-html="formatMessage(msg.text)"></span>
          </div>
        </div>
      </transition-group>
    </div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        messages: [],    // todas as mensagens
        nextId: 1,       // ID sequencial
        prefixes: {
          informacao: 'Info:',
          sucesso:    'Sucesso:',
          aviso:      'Aviso:',
          erro:       'Erro:'
        },
        presets: {
          'superior-direito':  { x: 1920 - 600 - 20, y: 20 },
          'superior-esquerdo': { x: 20, y: 20 },
          'inferior-direito':  { x: 1920 - 600 - 20, y: 1080 - 20 },
          'inferior-esquerdo': { x: 20, y: 1080 - 20 },
          'centro-superior':   { x: (1920-600)/2, y: 20 },
          'centro-inferior':   { x: (1920-600)/2, y: 1080-20 },
          'centro':            { x: (1920-600)/2, y: (1080-1080)/2 + 540 }
        }
      },
      computed: {
        // Agrupa por posição
        groups() {
          return this.messages.reduce((acc, msg) => {
            acc[msg.pos] = acc[msg.pos] || [];
            acc[msg.pos].push(msg);
            return acc;
          }, {});
        }
      },
      methods: {
        // Calcula X
        posX(pos) { return this.presets[pos]?.x || this.presets['superior-direito'].x; },
        // Calcula Y
        posY(pos) { return this.presets[pos]?.y || this.presets['superior-direito'].y; },
        // Recebe mensagem do FiveM e adiciona
        addMessage({ text, pos, dur, level }) {
          const id = this.nextId++;
          this.messages.push({ id, text, pos, level, exiting: false });
          // Remove após duração
          setTimeout(() => this.removeMessage(id), dur);
        },
        // Marca para saída (animação)
        removeMessage(id) {
          const msg = this.messages.find(m => m.id === id);
          if (msg) msg.exiting = true;
        },
        // Ao fim da animação de saída, retira do array
        onAnimationEnd(msg) {
          if (msg.exiting) {
            this.messages = this.messages.filter(m => m.id !== msg.id);
          }
        },
        // Converte **texto** em <strong>
        formatMessage(txt) {
          return txt.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        }
      },
      mounted() {
        window.addEventListener('message', e => {
          const d = e.data;
          if (d?.action === 'infobox') {
            this.addMessage({
              text:     d.message,
              pos:      d.position || 'superior-direito',
              dur:      d.duration || 4000,
              level:    d.level || 'informacao'
            });
          }
        });
      }
    });
  </script>
</body>
</html>
